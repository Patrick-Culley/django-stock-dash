{% load static %}

<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'stocks/base.css' %}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,300,0,0" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
 
<!-- <div class="container-fluid">
    {% include "stocks/header.html" %}
    {% include "stocks/navigation.html" %}
</div> -->

<!-----NAVBAR------>
<nav class="navbar navbar-expand-lg" style="background-color: #0d0c1d;">
    <div class="container-fluid">
        <span class="nav-brand" style="font-size: 45px; width: 270px;"><a href="{% url 'index' %}" style="text-decoration: none; color: white;"> TradingPulse</a></span>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <span class="material-symbols-outlined" style="font-size: 65px; font-weight: normal;">insert_chart</span>
          </li>
        </ul>
        <form class="d-flex" role="search">
            <span class="material-symbols-outlined" style="font-size: 40px;">search</span>
            <span style="padding-top: 10px; padding-right: 25px;">Search</span>
            <span class="material-symbols-outlined" style="font-size: 40px;">list</span>
            <span style="padding-top: 10px; padding-right: 25px;">
            <a href="{% url 'watchlist' %}" style="text-decoration: none; color: white;">Watchlist</a></span>
            <button class="btn btn-primary col-12" style="width: 100px; font-size: 18px;"type="submit">
            <a href="{% url 'login' %}" style="text-decoration: none; color: white;">Log Out</a> </button>
            </form>
        </form>
      </div>
    </div>
  </nav>
  <div class="jumbotron jumbotron-fluid" style="text-align: left;">
    <div class="container" style="padding-top: 20px;width: 100%;">
      <!-- <h1 class="display-4" style="font-weight: bold;">{{greetingtime}} <span style="color: #22ab94;">{{user}},</span></h1> -->
      <h1 class="display" style="font-weight: bold; font-size: 36px">Watchlist</h1>
      <p class="lead">Most up-to-date figures.</p>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<container>
    <row>
        {% for el in form%}        
        <div class="row mt-2 text-light">
            <ul class="col-md-12 text-light list-group list-group-horizontal list-group-flush" style="background-color: #0d0c1d;">
                <li class="col-md-1 list-group-item custom" style="border: none; background-color: #0d0c1d;">
                    <span class="icon"><img src={{el.image}} alt="img" class="rounded-circle img-thumbnail icon"></span> </li>
                <li class="col-md-3 text-light list-group-item pt-4" style="border: none; background-color: #0d0c1d;" id="custom"><strong>{{el.companyName}}<br>
                <div>
                  <canvas id="{{ forloop.counter0 }}" style="height: 300px; width: 300px;"></canvas>
                </div>
                  <input value="{{ forloop.counter0 }}" id="quotes" type="number" style="display: none;">
                <script>
                  var counter = document.getElementById("quotes") 
                  var ctx = document.getElementById('{{ forloop.counter0 }}');
                  var quotes = {{ quotes|safe }}
                  var count = {{forloop.counter0}}
                  console.log(count)
                  new Chart(ctx, {
                    type: 'line',
                    data: {
                      labels: quotes[count],
                      datasets: [{
                        data: quotes[count],
                        borderWidth: 1,
                        pointRadius: 0  
                      }]
                    },
                    options: {
                      plugins: {
                        legend: {
                          display: false
                        }
                      },
                      scales: {
                        y: {
                          beginAtZero: false
                        }
                      }
                    }
                  });
                </script>
                </strong></li>
                <li class="col-md-1 text-light list-group-item pt-4" style="border: none; background-color: #0d0c1d; font-size: 22px;"><strong>Current price:</strong><br>{{el.price}}</li>
                {% if el.changes <= 0 %}
                    <li class="col-md-1 text-light list-group-item pt-4" style="border: none; background-color: #0d0c1d; font-size: 22px;"><strong>Change:</strong><br><span class="text-danger">{{el.changes | floatformat:2 }}</span></li>
                {% elif el.changes >= 0  %}
                    <li class="col-md-1 text-light list-group-item pt-4" style="border: none; background-color: #0d0c1d; font-size: 22px;"><strong>Change:</strong><br><span class="text-success">{{el.changes | floatformat:2 }}</span></li>
                {% endif %}
                <li class="col-md-2 text-light list-group-item pt-4" style="border: none; background-color: #0d0c1d; font-size: 22px;"><strong>Range: </strong><br>{{el.range}}</li>
                <li class="col-md-2 text-light list-group-item pt-4" style="border: none; background-color: #0d0c1d; font-size: 22px;"><strong>Market Cap: </strong><br>{{el.mktCap}}</li>
                <li class="col-md-1 text-light list-group-item pt-4" style="border: none; background-color: #0d0c1d; font-size: 22px;"><strong>Beta: </strong><br>{{el.beta}}</li>
                <li class="col-md-1 text-light text-center list-group-item pt-4" style="border: none; background-color: #0d0c1d; font-size: 22px;">
                    <form action="{% url 'delete' %}" method="POST">
                        {% csrf_token %}
                        <input name="delete" type="hidden" value="{{el.symbol}}">
                        <input type="submit" value="Delete" class="btn btn-lg btn-danger">
                    </form>
                </li>
            </ul>
        </div>
        {% endfor %}
    </row>
</container>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha384-nvAa0+6Qg9clwYCGGPpDQLVpLNn0fRaROjHqs13t4Ggj3Ez50XnGQqc/r8MhnRDZ" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>
</body>
</html>